{% extends 'base.html' %}

{% block header %}
<h1 class="chat-title">{% block title %}Dashboard{% endblock %}</h1>
{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- Video Card -->
    <div class="card video-card">
        <h2>Painel Ao Vivo</h2>
        <video autoplay muted loop playsinline style="width:100%; border-radius:12px;">
            <source src="static/images/painel1.mp4" type="video/mp4">
        </video>
        <p>
            Local: Satelite Iris, Campinas-SP
        </p>
    </div>

    <!-- Chat Card -->
    <div class="card chat-card">
        <h2>SolarChat</h2>
        <div class="chat-wrapper">
            <form id="chat-gen" class="chat-form" method="post" style="display:flex; gap:10px;">
                <input type="text" name="user_input" placeholder="Type a message..." class="chat-input" style="flex:1;">    
                <input class="chat-button" type="submit" value="Send">
            </form>

            <!-- Automatic Message Buttons -->
            <div class="auto-buttons">
                <button type="button" class="auto-btn" data-msg="Explique que as placas estao operando t">Operação Padrão</button>
                <button type="button" class="auto-btn" data-msg="Explique a atual situação das placas">Resumo de Funcionamento</button>
                <button type="button" class="auto-btn" data-msg="As placas estão limpas? Faça um pequeno feedback do seu estado">Status de Limpeza</button>
                <button type="button" class="clean-btn" data-msg="A placa solar está suja. Favor realizar limpeza.">Alerta: Limpeza Necessária</button>
                <button type="button" class="auto-btn" id="technical-btn">Dados Técnicos</button>
            </div>
        </div>
        <div class="chat-answer"></div>
    </div>

    <!-- Technical Data Section (Hidden by Default) -->
    <div class="card plots-card" id="technical-data">
        <h2>Dados Técnicos</h2>
        <div class="plots-section">
            <div id="voltage-input-plot" class="plot"></div>
            <div id="current-input-plot" class="plot"></div>
            <div id="voltage-output-plot" class="plot"></div>
            <div id="current-output-plot" class="plot"></div>
            <div id="output-signal-plot" class="plot"></div>
        </div>
    </div>

    <!-- Energy Metrics -->
    <div class="card energy-card">
        <h2>Métricas de Energia</h2>
        <p>Potência instantânea: <span id="instant-power">-- kWh</span></p>
        <p>Potência acumulada do mês: <span id="monthly-power">-- kWh</span></p>
        <div id="monthly-history-plot" class="plot"></div>
        <p>Economia estimada: <span id="money-saved">-- R$</span></p>
        <div id="community-consumption-plot" class="plot"></div>
        <div id="excess-plot" class="plot"></div>
        <!-- Voting for excess -->
        <div class="vote-section">
            <h3>Destino do Excedente</h3>
            <button class="vote-btn" data-choice="Armazenamento">Armazenamento</button>
            <button class="vote-btn" data-choice="Doação">Doação</button>
            <button class="vote-btn" data-choice="Venda">Venda</button>
            <p id="vote-result">Escolha ainda não feita</p>
        </div>
    </div>
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
